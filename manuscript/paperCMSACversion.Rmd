---
title: |
  |  \large Assessing the Impact: A Survival (Re)Analysis of Hockey Enforcers vs. Non-Enforcers
author: | 
abstract: |
 | A recent study looked at the relationship between long-term mortality and being an enforcer in the National Hockey League between 1967 and 2022.  They performed a matched cohort study that found no significant difference in the mortality rates of enforcers versus non-enforcers (where “enforcer” is defined based on number of career fights or average career penalty minutes).  They then perform an additional sub-analysis conditioning on players that were currently deceased and looking at just this subset of players, they find a significant difference in the mean age at death between the enforcers and non-enforcers groups (45.2 vs 55.2; p-value= 0.02) thus reaching the conclusion that enforcers died an average of 10 years earlier than non-enforcers. However, some of the statistical methods used to reach their conclusions were unconvincing, specifically the approach used to reach this last claim.  Therefore, we undertook a re-analysis of their study using a survival analysis approach, which we believe is the natural method to use to study this question.  In addition, we augmented their data by scraping hockey-reference to find more instances of players who were deceased.  Then, using a Cox proportional hazards model, we found no significant difference in survival rate between enforcers and non-enforcers when an enforcer was defined based on the number of career fights.  However, when an enforcer was defined by average career penalty minutes, a significant difference was observed, which was notably not found in the original article.  Specifically, we find an estimated hazard ratio of enforcers to non-enforcers of 2.29 (p-value: 0.00169).  Therefore, we agree with the sentiment of the original paper that there is some difference between survival of these two groups, but we believe our approach to estimating this effect is more appropriate and that the magnitude of the effect in the original article is overstated.
 \vspace{2mm} 
  |
 Keywords: survival analysis, hockey
bibliography: references.bib
fontsize: 10pt
link-citations: true
linkcolor: cyan
urlcolor: cyan
output:
  pdf_document:
    df_print: kable
    number_sections: true
    keep_tex: true
header-includes:
 \usepackage{setspace}
 \setstretch{1}
 \usepackage{float}
 \floatplacement{figure}{t}
---

<!-- old title: Enforcers are not okay, probably. -->
```{r setup, echo=FALSE, message=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	fig.align = "center",
	message = FALSE,
	warning = FALSE
)

gjm <- function(x, color = "red") {
  sprintf("\\textcolor{%s}{%s}", color, x)}
```

```{r pkgs}
library(tidyverse)
library(dplyr)
library(stringr)
theme_set(theme_minimal())
```


```{r echo = FALSE}
#Reading in the raw data from the paper.  
library(tidyverse)
gen_JAMA <- read.csv("../JAMA NHL Data/General-Table 1.csv")
death_JAMA <- read.csv("../JAMA NHL Data/Deaths-Table 1.csv")

dead <- read.csv("../deaths.csv")
#Filtering for players who started in or after 1967.  
dead <- dead %>% filter(From >= 1967 & Name != "Name")



# Pelle Lindbergh -> that was his real name, no other spelling, not sure about this one
dead$Name[dead$Name == 'Lars-Erik SjÃ¶berg'] <- 'Lars Sjoberg'
dead$Name[dead$Name == 'BjÃ¸rn Skaare'] <- 'Bjorn Skaare'
dead$Name[dead$Name == 'Roger HÃ¤gglund'] <- 'Roger Hagglund'
dead$Name[dead$Name == 'Michel Larocque'] <- 'Mario Larocque' # matched by birth year
#	Fern Rivard -> Bob Rivard is in JAMA but the birthdays don't match, this is Fernand Joseph Rivard who is not in JAMA
dead$Name[dead$Name == 'Yanick DuprÃ©'] <- 'Yanick Dupre'
dead$Name[dead$Name == 'DuÅ¡an PaÅ¡ek'] <- 'Dusan Pasek'
# Roy Edwards -> this is Allan Roy Edwards (matched w/ google by birthday), not in JAMA
dead$Name[dead$Name == 'StÃ©phane Morin'] <- 'Stephane Morin'
dead$Name[dead$Name == 'Dmitri Tertyshny'] <- 'Dimitri Tertyshny'
# Garry Bauman -> Garry Glenwood Bauman, matched on google by birthday, not in JAMA under gary, Garry, Bauman, or Glenwood
dead$Name[dead$Name == 'GaÃ©tan Duchesne'] <- 'Gaetan Duchesne'
# Michel Plasse -> Michel Pierre Plasse, matched by birthday, not in JAMA under Michel, Pierre, or Plasse
# Chris Worthy -> Christopher John Worthy, matched by birthday, not in JAMA under last name Worthy or 'Christopher John'
dead$Name[dead$Name == 'Miroslav DvoÅ™Ã¡k'] <- 'Miroslav Dvorak'
# Wayne Stephenson -> Wayne Frederick Stephenson, matched by birthday, not in JAMA under Wayne or Frederick
dead$Name[dead$Name == 'Igor Vyazmikin'] <- 'Igor Viazmikin'
dead$Name[dead$Name == 'Rick Martin'] <- 'Richard Martin'
dead$Name[dead$Name == 'Karel RachÅ¯nek'] <- 'Karel Rachunek'
dead$Name[dead$Name == 'KÄrlis SkrastiÅ†Å¡'] <- 'Karlis Skrastins'
dead$Name[dead$Name == 'Josef VaÅ¡Ã­Äek'] <- 'Josef Vasicek'
dead$Name[dead$Name == 'Kaspars AstaÅ¡enko'] <- 'Kaspars Astashenko'
dead$Name[dead$Name == 'Jeff McDill'] <- 'Jeffrey McDill'
# Joe Junkin -> Joseph Brian Junkin, matched by birthday, last name not present in JAMA
# Andre Gill -> there is another player born in 84 with the same name but neither are in JAMA
# Seth Martin -> matched by birthday, didn't go by another name, not in JAMA
#	Don McLeod -> Donald Martin McLeod, matched by birthday, not in JAMA 
dead$Name[dead$Name == 'Greg Parks'] <- 'Gregory Parks'
# Ken Broderick -> Kenneth Lorne Broderick, matched by birthday, last name not in JAMA
# Don Caley -> Donald Thomas Caley, matched by birthday, last name not in JAMA
# Ed Dyck -> Edwin Paul 'Ed' Dyck, matched by birthday, NOT Henry Dyck who is only Dyck in JAMA
#	Sergei Mylnikov -> Sergei Aleksandrovich Mylnikov, matched by birthday, not in JAMA
dead$Name[dead$Name == 'Marek SvatoÅ¡'] <- 'Marek Svatos'
#Ray Emery -> Raymond Robert Emery, matched by birthday, last name not in JAMA
dead$Name[dead$Name == 'Bob Sullivan'] <- 'Robert Sullivan'
dead$Name[dead$Name == 'Denis DupÃ©rÃ©'] <- 'Denis Dupere'
#	Jim McLeod -> Jimmy McLeod, birthday doesn't match any McLeods in JAMA
dead$Name[dead$Name == 'Dmitri Nabokov'] <- 'Dimitri Nabokov'
# Jim Pettie -> James 'Seaweed' Pettie, matched by birthday, last name not in JAMA
#	Tony Esposito -> Anthony James "Tony O" Esposito, matched by birthday, not in JAMA
dead$Name[dead$Name == 'Miroslav FryÄer'] <- 'Miroslav Frycer'
# Gary Inness -> Gary George Inness, matched by birthday, last name not in JAMA
# Matiss Kivlenieks -> Matiss Kivlenieks, matched by birthday, not in JAMA
dead$Name[dead$Name == 'RenÃ© Robert'] <- 'Rene Robert'
# Ken Brown -> Kenneth Murray Brown, matched by birthday, not in JAMA
# Robbie Moore -> Robert David Moore, matched by birthday, not in JAMA
# Curt Ridley -> Charles Curtis Ridley, matched by birthday which is actually off by one day but def not Mike Ridley in JAMA
dead$Name[dead$Name == 'Greg Tebbutt'] <- 'Gregory Tebbutt'
#Mike Blake -> Michael Wilmer Blake, matched by birthday, not in JAMA
dead$Name[dead$Name == 'Petr KlÃ­ma'] <- 'Petr Klima'
dead$Name[dead$Name == 'BÃ¶rje Salming'] <- 'Borje Salming'


gen_JAMA$GP <- as.numeric(gsub(",","",gen_JAMA$GP))
gen_JAMA$PIM <- as.numeric(gsub(",","",gen_JAMA$PIM))
dead$GP <- as.numeric(dead$GP)
dead$From <- as.numeric(dead$From)
dead$G <- as.numeric(dead$G)
#gen_JAMA %>% filter(X1st.Season.Corrected >= 1967) %>% nrow()
dat <- gen_JAMA %>% filter(X1st.Season.Corrected >= 1967) %>% left_join(select(dead,Name,Birth.Date,Death.Date,GP),by = c("Player" = "Name" ))

#Remove goalies 
#There is no one to remove because there are no goalies in the original JAMA data set.  
dat <- dat %>% filter(Pos != "G")



#Dataprep
dat <- dat %>% mutate(dead = !is.na(Death.Date), 
                      DOB = as.Date(DOB), 
                      Death.Date = as.Date(Death.Date))
#I'm using the date of the latest death date as the censoring time: May 7, 2023
dat$Death.Date[!dat$dead] <- as.Date("2023-05-07")
dat$age <- (dat$Death.Date - dat$DOB)/365
dat$Ht <- as.numeric(dat$Ht)
dat$Wt <- as.numeric(dat$Wt)
dat$FperG <- dat$Total.Fights/dat$GP.x
dat$Pos <- as.factor(dat$Pos)
dat$Ctry2 <- dat$Ctry
dat$Ctry2[!dat$Ctry2 %in% c("FIN","CZE","RUS","SWE","USA","CAN")] <- "OTH" 
dat$Ctry2 <- as.factor(as.character(dat$Ctry2))
#At least 50, not greater than 50.
dat$EF <- dat$Total.Fights>=50

#dat <- dat[!duplicated(dat$Player),] #6005 obs left

#Cleaning penalty minutes
pm_temp <- data.frame(do.call(rbind,strsplit(dat$PIM.GP,":")))
dat$PIM.GP_numeric <- as.numeric(pm_temp[,1]) + as.numeric(pm_temp[,2])/60
dat$EP <- dat$PIM.GP_numeric >=3
#I match the paper's n = 183 EP. But when I remove the people with missing height, I lose one to 182

#Removed 4 rows missing height
dat <- dat %>% filter(!is.na(Ht))

dat$Pos2 <- as.character(dat$Pos)
dat$Pos2[dat$Pos2 %in% c("L","R")] <- "W"
dat$Pos2 <- factor(dat$Pos2)

summ <-
  dat %>% group_by(EF) %>% summarize(
    n = n(),
    mnGP = round(mean(GP.x), 2),
    seGP = round(sd(GP.x), 2),
    mnage = round(mean(age), 2),
    seage = round(sd(age) / sqrt(n),3),
    mnwt = round(mean(Wt), 2),
    sewt = round(sd(Wt) / sqrt(n),3),
    mnht = round(mean(Ht), 2),
    seht = round(sd(Ht) / sqrt(n),3),
    mngoals = round(mean(G), 2),
    segoals = round(sd(G) / sqrt(n),3),
    mntf = round(mean(Total.Fights), 2),
    setf = round(sd(Total.Fights) / sqrt(n),3),
    mnpimgp = round(mean(PIM.GP_numeric), 2),
    sepimgp = round(sd(PIM.GP_numeric) / sqrt(n),3),
    pD = round(mean(Pos2 == "D"),3),
    pW = round(mean(Pos2 == "W"),3),
    pC = round(mean(Pos2 == "C"),3)
    
  )

summEP <-
  dat %>% group_by(EP) %>% summarize(
    n = n(),
    mnGP = round(mean(GP.x), 2),
    seGP = round(sd(GP.x), 2),
    mnage = round(mean(age), 2),
    seage = round(sd(age) / sqrt(n),3),
    mnwt = round(mean(Wt), 2),
    sewt = round(sd(Wt) / sqrt(n),3),
    mnht = round(mean(Ht), 2),
    seht = round(sd(Ht) / sqrt(n),3),
    mngoals = round(mean(G), 2),
    segoals = round(sd(G) / sqrt(n),3),
    mntf = round(mean(Total.Fights), 2),
    setf = round(sd(Total.Fights) / sqrt(n),3),
    mnpimgp = round(mean(PIM.GP_numeric), 2),
    sepimgp = round(sd(PIM.GP_numeric) / sqrt(n),3),
    pD = round(mean(Pos2 == "D"),3),
    pW = round(mean(Pos2 == "W"),3),
    pC = round(mean(Pos2 == "C"),3)
  )

```   




# Introduction {#sec:intro}

Fighting in the National Hockey League (NHL) has been an integral part of the sport since the earliest days of the league. More than just a way to express frustration, players often use fighting strategically to the benefit of the team. One of these strategies includes instigating a fight when a player from the opposite team has violated an unwritten rule of the game, which historically has led to hockey teams carrying so-called "enforcers" on their rosters. The enforcer is the teammember tasked with fighting these opposing players. While this is not an officially defined position, the nature of needing to be able to fight any opponent generally designates the biggest and strongest players as those most likely to be enforcers. 

@Colburn1986 discusses the intentions behind these public fights. The crowd gets energized and entertained, but more importantly, the fight is a stage used to establish the social customs and expectations of players on the ice.  Specifically, they say, "insofar as the fist-fight is the locus of socially available beliefs concerning the moral character and integrity of players, ... the fist-fight represents a mode of informal social control among players".  

@Silverwood2015, who looked anecdotally at how enforcers fit into a team atmosphere,  noticed that teammates put their enforcers on a pedestal. Performing well as an enforcer leads to the player being seen as a protector. When an enforcer fulfills these additional responsibilities to being on the ice as a normal player, players say that it is common for that enforcer to receive perks, such as not paying for their own meals or getting the best seat on the bus. They go as far as to say these players are "deified", emphasizing the social aspects of hockey that surround this history of violence. 


The use of violence to enforce social norms in the sport, of course, also has the potential to increase injury and other long-term negative effects for hockey players. While any hockey player may participate in fighting, enforcers are exposed to many more fights than the typical NHL player. As a result of being exposed to more physical contact, they are potentially exposed to additional head trauma when compared to the broader hockey player population, putting them at potentially higher risk for long-term health outcomes. The ingrained nature of fighting into the game of hockey is therefore widely criticized, which has led to declines in the use of hockey violence. For example, figure \ref{fig:enforcer_density} shows a decline in the proportion of enforcers (as defined by @Popkin2023) to non-enforcers as players get younger. This brings forth the question of whether hockey will continue to move away from contact-driven strategies in favor of younger, faster, and highly-skilled players.


<!-- The question is, should the game continue to move away from contact-driven strategy in favor of younger, faster, highly-skilled players? -->

```{r enforcer_density, echo = FALSE, fig.cap='Density Plot of Study Cohorts by DOB'}
#Note: I think the blue should be labeled as total players because it's stacked 
cohort_dat = dat %>% mutate(cohort = case_when(PIM.GP > 3 ~ 'Enforcer',
                                  #Total.Fights > 50 ~ 'Enforcer',
                                  .default = 'Non-Enforcer')) 

cohort_dat$cohort = as.factor(cohort_dat$cohort)

cohort_dat$cohort <- factor(cohort_dat$cohort, levels = c('Non-Enforcer', 'Enforcer'))

#ggplot(cohort_dat, aes(x = DOB)) + geom_density(aes(fill = cohort),alpha = 0.75 )

ggplot(cohort_dat, aes(x = DOB)) +
  geom_freqpoly(aes(color = cohort),alpha = 0.75 , position = 'stack') +
  scale_color_manual(values = c('#00bFC4', '#F8766d'))
```


@Popkin2023 explored the effects of being an enforcer on mortality rates, ages at death, and causes of death to address the long-term impact this repeated contact might have. They defined enforcers in two ways: (1) those who had 50 or more career fights (E-F cohort) and (2) those who had, on average, more than 3 penalty minutes per game (E-P cohort). 

Based on their analysis (a matched cohort study) they find that there is no statistically significant difference in the mortality rates between enforcers and controls for either definition of enforcer. However, they do find that enforcers died on average about 10 years earlier than their non-enforcer counterparts. Additionally, while there was no significant difference in all-cause mortality rate, they do suggest that enforcers in their sample died more frequently of drug overdose and suicide.


<!-- Most notably, the method used to reached their most sensational finding - enforcers died on average about 10 years earlier than their non-enforcer counterparts - is statistically unsuitable. Specifically, to reach this conclusion, they use the data from the matched cohort study but then condition on death.  This effectively breaks the matching that they appropriately used to compare mortality rates, and therefore this conclusion is not statistically valid.   -->

However, we believe that some of the statistical methods used in @Popkin2023 to reach these conclusions are not the best choices given the problem that is studied.  Here, we attempt not to replicate the results of the analysis in @Popkin2023, but what we believe to be more appropriate statistical methods, specifically survival analysis techniques. This shift in perspective allows us to overcome the weakness of mortality rate, which is that it is a function of when it is calculated (i.e. In all cases, mortality rate will be 100% when all members of the original sample have died). Instead, survival analysis provides a survival curve, which can be used to analyze how the probability of survival changes over time.  In addition, we augmented the data used in @Popkin2023 to increase the sample size in the analysis and include more deceased players in the data set. 

The outcome of this study is relevant to the debates about regulations and discourse around head trauma in hockey (and other sports).  An accurate analysis is imperative to prevent the spread of misinformed conclusions and best inform regulatory safety practices going forward.  

There is much work demonstrating that elite athletes on average live longer than the general population. @Antero2021, as just one example, estimates that "Olympic athletes live 5.1 years longer than the general population" and @Garatachea2014 presents a large meta-analysis of elite-level athletes life spans and concludes that life expectancy for these elite-level athletes is higher when compared to the population at large.  

However, several studies that have examined life expectancy for athletes involved in sports with more physical contact / more collisions have found evidence of associations between this contact and reduced life expectancy.  @Zwiers2012 examined Olympians across many sports and found that those elite athletes participating in sports with high levels of physical contact exhibited mortality at higher rates later in life than Olympians in less contact heavy sports.  They then estimate the hazard ratio associated with high contact sports to be 1.13 (95% CI: 1.06-1.21).  @Bianco2007 looked at life expectancy across different sports and did not find any significant results.  However, they note that the median life expectancy for boxers was 73 years compared to an overall median of 76 years.  

The topic of @Popkin2023's study fits in with this line of work with a focus specifically on one type of hockey player (i.e. the enforcer).  While these did not identify any significant differences in mortality rates between the enforcers and non-enforcers, they do find shorter lifespans among enforcers who were deceased.  We believe that this topic is of great interest, which is why we engaged in a re-analysis with additional data of the original work.  By using more appropriate statistical techniques, out hope is to gain a clearer picture of the 
the conclusions reacdhed in the original work of @Popkin2023.  



<!-- https://journals.lww.com/headtraumarehab/fulltext/2012/11000/Life_Expectancy_Following_Rehabilitation__A_NIDRR.15.aspx -->

<!-- Bianco2007:  "Median LE of the samples was 76.0 yrs and no differences were observed in different sports, although it was lower in boxers (73.0 yrs) and higher in tennis players (79.0 yrs)."  -->

<!-- "Those who engaged in disciplines with high levels of physical contact had higher mortality than other Olympians later in life." "the increased mortality associated with high physical contact persisted (hazard ratio 1.13, 1.06 to 1.21)" -->



<!-- However, contact bla h blahj -->


<!-- : The evidence available indicates that top-level athletes live longer than the general population and have a lower risk of 2 major causes of mortality, namely, CVD and cancer. -->



<!-- Antero2021: Olympic athletes live 5.1 years longer than the general population. -->

<!-- Zwiers2012: "Those who engaged in disciplines with high levels of physical contact had higher mortality than other Olympians later in life." "the increased mortality associated with high physical contact persisted (hazard ratio 1.13, 1.06 to 1.21)" -->






<!-- we instead found more data using web-scraping methods and the NHL website to facilitate a reanalysis of the effects of being an enforcer in terms of survival time rather than mortality rate. This shift in perspective allows us to overcome the downfall of mortality rate, which is that it is a function of when it is calculated. Eventually, the mortality rate will always be 100% when all members of the original sample have died. Instead, survival analysis provides a survival curve, which can be used to analyze how the probability of survival changes over time.  -->

<!-- Inspired by the applicability of survival analysis to this study, and concerned about the gravity of @Popkin2023's conclusions in light of the statistical methods originally used, we instead found more data using web-scraping methods and the NHL website to facilitate a reanalysis of the effects of being an enforcer in terms of survival time rather than mortality rate. This shift in perspective allows us to overcome the downfall of mortality rate, which is that it is a function of when it is calculated. Eventually, the mortality rate will always be 100% when all members of the original sample have died. Instead, survival analysis provides a survival curve, which can be used to analyze how the probability of survival changes over time.  -->



 
 <!-- Then, each of these enforcer players was matched to a non-enforcer counterpart based on date of birth, total games played, height, weight, and position played (C-F and C-P cohorts, respectively).  -->

<!-- Their analysis continues by considering the E-F cohort and their matched controls separately from the E-P cohort. Conditioning on death, they then estimated, separately, that the enforcer groups from each cohort (E-F = 13, E-P = 13) died on average 10 years before their non-enforcer counterparts(C-F = 14, C-P = 10). Then, considering all enforcers from both cohorts together, and all controls from both cohorts together, and then conditioning on death (resulting in 21 enforcers and 24 controls), they draw the conclusion that there is not a significant difference in all-cause mortality rate but that enforcers died more frequently of drug overdose and suicide.  -->
<!-- `r gjm("Lets make this above paragraph clearer")` -->


<!-- In the matched cohort study presented in @Popkin2023, enforcers were matched to non-enforcers on birth year, weight, height, etc.  After matching, mortality rates between the two groups were computed.  Neither definition of enforcers (i.e. E-F or E-P) yielded significant difference in the mortality rates between enforcers and non-enforcers.   -->

<!-- <!-- (Greg comment: After matching you CAN compare mortality rates and that comparison would be valid AT THAT GIVEN POINT when they are compared.  But a better analysis would be to use survival analysis.  The problem with mortality rate is that eventually everyone in both groups will be dead if you wait long enough and that comparison is meaningless. Survival times are much better comparison. ) --> 

<!-- However, the authors of @Popkin2023 next conditioned on death yielding a sample size of n = 13 and n = 14 for the enforcer (defined by total fights) vs non-enforcer group, respectively, and show that the age at death is about 10 years less for the enforcers group relative to the non-enforcer group (p = 0.03).  This approach is not statistically valid, since once death is conditioned upon, the matching that is used to balance the two groups is broken and they can become imbalanced, which is what we believe the authors in @Popkin2023 observed.  -->

<!-- Interesting paper: Don't do PS matching: https://gking.harvard.edu/publications/why-propensity-scores-should-not-be-used-formatching -->

<!-- silverwood: https://orca.cardiff.ac.uk/id/eprint/86257/12/Victoria%20Silverwood%20Final%20Thesis%20SIGS%20REMOVED.pdf -->

<!-- colburn: https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1533-8525.1986.tb00249.x -->

# Data 

## Data from original paper
We obtained the two data sets used in @Popkin2023: general table (n = 7,432) and death table (n = 45).  As in @Popkin2023, we considered only players who's first season was 1967 or later and played any games between the 1967-68 and the 2021-22 NHL seasons.  This leaves 6,039 players after filtering (the exact number mentioned in @Popkin2023).  We then removed 4 players with missing height, leaving us with `r nrow(dat)` (6,035) remaining observations, of which 252 are deaths, for our re-analysis. 


For direct comparison to @Popkin2023, we defined enforcers using the same two definitions that they used: 
 1. Enforcers-Fights (E-F): Any player with at least 50 career fights (n = 331)
 2. Enforcers-Penalty Minutes (E-P): Any player who averaged at least 3 penalty minutes per game (n = 183)


We note than in @Popkin2023, they find 183 E-P enforcers; we have only 182 in our data set with the discrepancy due the the removal of the 4 players with missing height information, which is used as a control variable in the survival analysis. 


## Additional Data
While @Popkin2023 only looks at a total of 45 deceased players  (21 enforcers and 24 controls), we identified `r sum(dat$dead)` players who were included in the data used in @Popkin2023 who were deceased as of May 7, 2023 based on data from hockey-reference.com.  

## Data summaries
Of the 6035 players included in this analysis, the average age was around 48 years old.  The average height and weight for these players was about 73 inches and 197 pounds, respectively.  A full summary of the overall data can be seen in table \ref{tab:EDAoverall}. 

<!-- This is what they matched on " including date of birth, total number of games played, height, weight, and position played." -->

In this same set of players, on average, enforcers in this data set tended to be older than the non-enforcers (EF: `r summ$mnage[summ$EF]` vs non-EF: `r summ$mnage[!summ$EF]` and EP: `r summEP$mnage[summEP$EP]` vs non-EP: `r summEP$mnage[!summEP$EP]`).  Additionally, as seen in Tables \ref{tab:EDAEF} and \ref{tab:EDAEP} enforcers tended to also be taller and heavier on average than non-enforcers. The means of age, weight, height and played are all significantly different between the enforcers and non-enforcer groups for both definitions of enforcers.  We also note differences some substantial differences in the positional distribution of enforcers vs non-enforcers.  Specifically, the percentage of defensive players in the enforcer vs non-enforcers is relatively close there are very few enforcers, defined with either E-F or E-P, who are listed as playing center.  This also means that the percentage of enforcers who are listed as wings (either right or left) is higher for enforcers than for non-enforcers.  The variables listed here are the same as those that were used for matching in @Popkin2023 (i.e. date of birth, total number of games played, height, weight and position).








<!-- Goals  & `r summ$mngoals[summ$EF]` (`r summ$segoals[summ$EF]`) & `r summ$mngoals[!summ$EF]` (`r summ$segoals[!summ$EF]`) & `r ifelse(round(t.test(dat$G~dat$EF)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$G~dat$EF)$p.value,2))`\\ -->


\begin{table}
\begin{center}
\begin{tabular}{|c|c|}
\hline
 Variable & mean (sd)\\
 \hline
 n & `r nrow(dat)`    \\
 n deceased & `r sum(dat$dead)` (`r paste0(round(100*sum(dat$dead)/nrow(dat),2),"\\%")`)    \\
 Games Played & `r  round(mean(dat$GP.x),2)` (`r round(sd(dat$GP.x),2)`)\\
 Age (Years) & `r round(mean(as.numeric(dat$age)),2)` (`r round(sd(as.numeric(dat$age)),2)`)\\
 Height (Inches) & `r round(mean(as.numeric(dat$Ht)),2)` (`r round(sd(as.numeric(dat$Ht)),2)`)\\
 Weight (Pounds) & `r mean(as.numeric(dat$Wt))` (`r sd(as.numeric(dat$Wt))`)\\
 Fights per game & `r mean(as.numeric(dat$FperG))` (`r sd(as.numeric(dat$FperG))`)\\
 Penalty Minutes per game  & `r mean(as.numeric(dat$PIM.GP_numeric))`  (`r  sd(as.numeric(dat$PIM.GP_numeric))`)\\
 \hline
\end{tabular}
\end{center}
\caption{Overall summary stats
\label{tab:EDAoverall}}
\end{table}




\begin{table}
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
 Variable & EF = TRUE & EF = FALSE & p-value \\
 \hline
 n & `r summ$n[summ$EF]` & `r summ$n[!summ$EF]` & \\
 Games Played & `r summ$mnGP[summ$EF]` (`r summ$seGP[summ$EF]`) & `r summ$mnGP[!summ$EF]` (`r summ$seGP[!summ$EF]`) & `r ifelse(round(t.test(dat$GP.x~dat$EF)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$GP.x~dat$EF)$p.value,2))`\\
 Age (years) & `r summ$mnage[summ$EF]` (`r summ$seage[summ$EF]`) & `r summ$mnage[!summ$EF]` (`r summ$seage[!summ$EF]`) & `r ifelse(round(t.test(dat$age~dat$EF)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$age~dat$EF)$p.value,2))`\\
 Weight (lbs) & `r summ$mnwt[summ$EF]` (`r summ$sewt[summ$EF]`) & `r summ$mnwt[!summ$EF]` (`r summ$sewt[!summ$EF]`) & `r ifelse(round(t.test(dat$Wt~dat$EF)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$age~dat$EF)$p.value,2))`\\
  Height (in) & `r summ$mnht[summ$EF]` (`r summ$seht[summ$EF]`) & `r summ$mnht[!summ$EF]` (`r summ$seht[!summ$EF]`) & `r ifelse(round(t.test(dat$Ht~dat$EF)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$Ht~dat$EF)$p.value,2))`\\
          percent D & `r paste0(100*summ$pD[summ$EF],"\\%")` & `r paste0(100*summ$pD[!summ$EF],"\\%")` & \\
    percent W & `r paste0(100*summ$pW[summ$EF],"\\%")` & `r paste0(100*summ$pW[!summ$EF],"\\%")` & \\
    percent C & `r paste0(100*summ$pC[summ$EF],"\\%")` & `r paste0(100*summ$pC[!summ$EF],"\\%")` & \\
    
 \hline
\end{tabular}
\end{center}
\caption{Comparing enforcers to non-enforcers when enforcer is defined as E-F \label{tab:EDAEF}}
\end{table}


\begin{table}
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
 Variable & EP = TRUE & EP = FALSE & p-value \\
 \hline
 n & `r summEP$n[summEP$EP]` & `r summEP$n[!summEP$EP]` & \\
 Games Played & `r summEP$mnGP[summEP$EP]` (`r summEP$seGP[summEP$EP]`) & `r summEP$mnGP[!summEP$EP]` (`r summEP$seGP[!summEP$EP]`) & `r ifelse(round(t.test(dat$GP.x~dat$EP)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$GP.x~dat$EP)$p.value,2))`\\
 Age (years) & `r summEP$mnage[summEP$EP]` (`r summEP$seage[summEP$EP]`) & `r summEP$mnage[!summEP$EP]` (`r summEP$seage[!summEP$EP]`) & `r ifelse(round(t.test(dat$age~dat$EP)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$age~dat$EP)$p.value,2))`\\
 Weight (lbs) & `r summEP$mnwt[summEP$EP]` (`r summEP$sewt[summEP$EP]`) & `r summEP$mnwt[!summEP$EP]` (`r summEP$sewt[!summEP$EP]`) & `r ifelse(round(t.test(dat$Wt~dat$EP)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$age~dat$EP)$p.value,2))`\\
  Height (in) & `r summEP$mnht[summEP$EP]` (`r summEP$seht[summEP$EP]`) & `r summEP$mnht[!summEP$EP]` (`r summEP$seht[!summEP$EP]`) & `r ifelse(round(t.test(dat$Ht~dat$EP)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$Ht~dat$EP)$p.value,2))`\\
    percent D & `r paste0(100*summEP$pD[summEP$EP],"\\%")` & `r paste0(100*summEP$pD[!summEP$EP],"\\%")` & \\
    percent W & `r paste0(100*summEP$pW[summEP$EP],"\\%")` & `r paste0(100*summEP$pW[!summEP$EP],"\\%")` & \\
    percent C & `r paste0(100*summEP$pC[summEP$EP],"\\%")` & `r paste0(100*summEP$pC[!summEP$EP],"\\%")` & \\
 \hline
\end{tabular}
\end{center}

\caption{Comparing enforcers to non-enforcers when enforcer is defined as E-P \label{tab:EDAEP}}
\end{table}





```{r echo = FALSE}
library(survival)
#Defining the survival variable
dat$Surv <- Surv(dat$age,dat$dead)
dat$EFchar <- "Enforcer"
dat$EFchar[!dat$EF] <- "Non-enforcer"
dat$EFchar <- as.factor(dat$EFchar)
dat$EPchar <- "Enforcer"
dat$EPchar[!dat$EP] <- "Non-enforcer"
dat$EPchar <- as.factor(dat$EPchar)

#Group forwards together
dat$Pos2 <- as.character(dat$Pos)
dat$Pos2[dat$Pos2 %in% c("L","R")] <- "W"
dat$Pos2 <- factor(dat$Pos2)
```

```{r KMEF, echo = FALSE, fig.cap="Kaplan Meier plot for E-F" }
library(ggsurvfit)
survfit2(Surv ~ EFchar, data = dat) %>%
  ggsurvfit() +
  labs(
    x = "Age",
    y = "Overall survival probability"
  ) +
  add_confidence_interval()
```

```{r KMEP, echo = FALSE, fig.cap="Kaplan Meier plot for E-P" }
library(ggsurvfit)
survfit2(Surv ~ EPchar, data = dat) %>% 
  ggsurvfit() +
  labs(
    x = "Age",
    y = "Overall survival probability"
  ) + 
  add_confidence_interval()
```

<!-- ```{r KMEP, echo = FALSE, fig.cap="Kaplan Meier plot for EP" } -->
<!-- dat <- dat %>% mutate(northamerica = ifelse(Ctry %in% c("USA","CAN"),"North America","Other")) -->
<!-- library(ggsurvfit) -->
<!-- survfit2(Surv ~ northamerica, data = dat) %>%  -->
<!--   ggsurvfit() + -->
<!--   labs( -->
<!--     x = "Age", -->
<!--     y = "Overall survival probability" -->
<!--   ) +  -->
<!--   add_confidence_interval() -->
<!-- ``` -->






# Methods {#sec:methods}
The analysis presented here utilizes all hockey players in the data, both alive and deceased, in a survival analysis to explore differences in survival times between enforcers an non-enforcers, which we believe to be a more appropriate method for analyizing the problem in this setting.  Rather than focusing on mortality rates, as in @Popkin2023, we instead focus on survival times and leverage survival analysis techniques, specifically Cox proportional hazards models, to look for differences in survival times of enforcers versus non-enforcers. 

 <!-- [[Why do we think survival analysis is the correct choice for analyzing this data.  Explain.  ]] -->
 <!-- See example 2 here for the problem with mortality rate: https://www.mcw.edu/-/media/MCW/Departments/Biostatistics/vo18no5online.pdf -->

Figures \ref{fig:KMEF} and \ref{fig:KMEP} show Kaplan-Meier plots for EF and EP.  There is substantial overlap in the K-M curves between the enforcer and non-enforcers groups when enforcers is defined using the EF criteria. However, the enforcer group defined by the EP criteria exhibits evidence of lower survival probabilities starting around age 50 relative to the non-enforcer group. Nevertheless, it is important to remember that these two groups differ substantially in age, height, and weight that may lead both to increased probability of becoming an enforcer and an increased probability in early death.

We note here that figure \ref{fig:KMEP} demonstrates clearly why mortality rate is often not an appropriate measure for comparing risk between groups.  If one were to look only at mortality rates at age 75, the mortality rates among these two groups are nearly identical (just under 20\%).  However, the enforcers survival curve is clearly below the non-enforcer survival curve estimate at almost every point below 75 indicating that enforcers are dying at younger ages on average even though the mortality rate eventually becomes nearly indistinguishable near the age of 75.  All of this is, by the way, exactly consistent with the findings of @Popkin2023 (i.e. no signficant difference in mortality rates, but enforcers dying at younger ages).  

In order to account for these differences between the groups, we estimated full Cox proportional hazard models @CoxPH: one for each definition of enforcer defined in @Popkin2023 (i.e. E-F and E-P) with time until death as the outcome variable. Further, the indicators for each definition of enforcer, games played (GP), height (Ht), weight (Wt), year of birth (DOB), and position indicators (Center (C), Wing (W), or Defender (D)) were added as control variables.

All analysis was performed in R version 4.4.0 @R using the survival library @survival-book.  

<!-- Greg doesn't think this conditioning on death is valid!  The point of matching is to balance the groups in regards to confounders.  However, after matching, you can't just look at a subset and compare between then two groups because you could end up with unbalanced sets!  And indeed we do see this!  For example, the weight in the dead enforcers group is on average higher than the weight of the dead non-enforcers group.   -->

```{r eval = FALSE, echo = FALSE}
#Coxph code for EF
coxphmod_EF <- coxph(Surv ~ EF + GP.x + Ht + Wt + DOB.Year + Pos2 , data = dat)
summary(coxphmod_EF)
library(xtable)
xtable(summary(coxphmod_EF)$coef[,-4], digits = 5)
cox.zph(coxphmod_EF)


newdataEF <-
  with(dat, data.frame(EF = c(TRUE, FALSE), 
                       GP.x = rep(mean(GP.x), 2),
                       Ht = rep(mean(Ht), 2),
                       Wt = rep(mean(Wt), 2),
                       DOB.Year = rep(mean(DOB.Year), 2),
                       I_forward = rep(1, 2))
                       )
plot(survfit(coxphmod_EF, newdata = newdataEF), conf.int = TRUE, lty = c(1,2))


nnn <- nrow(survfit(coxphmod_EF, newdata = newdataEF)$surv)
ggdat <- data.frame(enforcer = c(rep("Enforcer",nnn),rep("Non-Enforcer",nnn)),
  surv = c(
  survfit(coxphmod_EF, newdata = newdataEF)$surv[, 1],
  survfit(coxphmod_EF, newdata = newdataEF)$surv[, 2]
),
  lower = c(
  survfit(coxphmod_EF, newdata = newdataEF)$lower[, 1],
  survfit(coxphmod_EF, newdata = newdataEF)$lower[, 2]
),
  upper = c(
  survfit(coxphmod_EF, newdata = newdataEF)$upper[, 1],
  survfit(coxphmod_EF, newdata = newdataEF)$upper[, 2]
),
time = rep(survfit(coxphmod_EF, newdata = newdataEF)$time,2)
)
ggplot(aes(x = time,y = surv, color = enforcer), data = ggdat) + geom_path() + geom_path(aes(x = time,y = lower, color = enforcer), lty = 3) + geom_path(aes(x = time,y = upper, color = enforcer), lty = 3) 

#Diagnostics plots for linearity
dat$residuals_EF <- coxphmod_EF$residuals
ggplot(aes(x = GP.x, y = residuals_EF), data = dat) + geom_point() + geom_smooth(color = "red")
ggplot(aes(x = Ht, y = residuals_EF), data = dat) + geom_point() + geom_smooth(color = "red")
ggplot(aes(x = Wt, y = residuals_EF), data = dat) + geom_point() + geom_smooth(color = "red")
ggplot(aes(x = DOB.Year, y = residuals_EF), data = dat) + geom_point() + geom_smooth(color = "red")


```

```{r eval = FALSE, echo = FALSE}
#Coxph code for EP
cor(dat[,c("PIM.GP_numeric","Ht","Wt","DOB.Year")])

coxphmod_EP <- coxph(Surv ~  EP + GP.x + Ht + Wt + DOB.Year + Pos2 , data = dat)
summary(coxphmod_EP)
library(xtable)
xtable(summary(coxphmod_EP)$coef[,-4],digits = 5)
cox.zph(coxphmod_EP)


newdataEP <-
  with(dat, data.frame(EP = c(TRUE, FALSE), 
                       GP.x = rep(mean(GP.x), 2),
                       Ht = rep(mean(Ht), 2),
                       Wt = rep(mean(Wt), 2),
                       DOB.Year = rep(mean(DOB.Year), 2),
                       I_forward = rep(1, 2))
                       )
plot(survfit(coxphmod_EP, newdata = newdataEP), conf.int = TRUE, lty = c(1,2))


nnn <- nrow(survfit(coxphmod_EP, newdata = newdataEP)$surv)
ggdat <- data.frame(enforcer = c(rep("Enforcer",nnn),rep("Non-Enforcer",nnn)),
  surv = c(
  survfit(coxphmod_EP, newdata = newdataEP)$surv[, 1],
  survfit(coxphmod_EP, newdata = newdataEP)$surv[, 2]
),
  lower = c( 
  survfit(coxphmod_EP, newdata = newdataEP)$lower[, 1],
  survfit(coxphmod_EP, newdata = newdataEP)$lower[, 2]
),
  upper = c(
  survfit(coxphmod_EP, newdata = newdataEP)$upper[, 1],
  survfit(coxphmod_EP, newdata = newdataEP)$upper[, 2]
),
time = rep(survfit(coxphmod_EP, newdata = newdataEP)$time,2)
)
ggplot(aes(x = time,y = surv, color = enforcer), data = ggdat) + geom_path() + geom_path(aes(x = time,y = lower, color = enforcer), lty = 3) + geom_path(aes(x = time,y = upper, color = enforcer), lty = 3) 



#Diagnostics plots for linearity
dat$residuals_EP <- coxphmod_EP$residuals
ggplot(aes(x = GP.x, y = residuals_EP), data = dat) + geom_point() + geom_smooth(color = "red")
ggplot(aes(x = Ht, y = residuals_EP), data = dat) + geom_point() + geom_smooth(color = "red")
ggplot(aes(x = Wt, y = residuals_EP), data = dat) + geom_point() + geom_smooth(color = "red")
ggplot(aes(x = DOB.Year, y = residuals_EP), data = dat) + geom_point() + geom_smooth(color = "red")

a <- coxph(Surv ~ PIM.GP_numeric  + GP.x + Ht + Wt + DOB.Year + Pos , data = dat)
summary(a)
library(xtable)
xtable(summary(a)$coef)
```


# Results {#sec:results}
Table \ref{tab:EF} shows the results for the Cox proportional hazards model when enforcers were defined based on their number of career fights.  No statistically significant difference was observed in the hazard functions of enforcers versus non-enforcers (p-value = 0.48977). However, a significant difference is observed between enforcers and non-enforcers when the enforcer is defined based on their number of penalty minutes per game (p-value = 0.00125).  The estimated hazard ratio for E-P is 2.34988, indicating a 135\% increase in the hazard for enforcers vs non-enforcers when all other variables are held constant.  

<!-- These numbers need to be recomputed -->
Figure \ref{fig:estsurv} shows the estimated survival curves for enforcers (E-P) versus non-enforcers for defenders with all continuous variables held constant at mean levels.  Using this, the estimated survival rate at the age of 50 for enforcers vs non-enforcers is 96.45\% (95\% CI: 94.44\%, 98.51\%) vs 98.47\% (95\% CI: 97.96\%, 98.99\%).  For the same conditions at the age of 75, the estimated survival rate for enforcers is about 74.01\% (95\% CI: 60.78\%, 90.23\%) compared to non-enforcers estimate survival rate of 88.00\% (95\% CI: 83.11\%, 93.18\%).  The estimated survival rate for enforcers drops an additional `r (96.45-74.01)-(98.47 - 88.00)`\% between the ages of 50 and 75 versus non-enforcers.





<!-- ind surv lower upper time -->
<!-- Enforcer	0.9644902	0.9443574	0.9850521	50 -->
<!-- Non-Enforcer	0.9847316	0.9795597	0.9899308	50 -->
 
<!--        enforcer      surv     lower     upper     time -->
<!-- 1     Enforcer 0.7405606 0.6078206 0.9022894 75.01096 -->
<!-- 2 Non-Enforcer 0.8800170 0.8311189 0.9317920 75.01096 -->


<!--
```{r popkin_conclusions, echo = FALSE, tab.cap = ""}
cf = read.csv('../JAMA NHL Data/C-F-Table 1.csv')
cp = read.csv('../JAMA NHL Data/C-P-Table 1.csv')

ef = read.csv('../JAMA NHL Data/E-F-Table 1.csv')
ep = read.csv('../JAMA NHL Data/E-P-Table 1.csv')

jama_controls = dat %>% filter(Player %in% cf$Player | Player %in% cp$Player)
  
jama_enforcers = dat %>% filter(Player %in% ef$Player | Player %in% ep$Player)

jama_short = rbind(jama_controls, jama_enforcers)

jama_deaths = read.csv('../JAMA NHL Data/Deaths-Table 1.csv')


cnclsn_sum = jama_short %>%
  filter(Player %in% jama_deaths$Enforcers) %>%
  mutate(enforcer = ifelse(EF == 1 | EP == 1, 1, 0), 
         deathage = as.numeric(difftime(Death.Date,
                                        Birth.Date,
                                        units = "weeks")/52.25)) %>% 
  group_by(enforcer) %>%
  summarize(`Mean YOB` = mean(DOB.Year), `Mean Age At Death` = mean(deathage))

precnclsn_sum = jama_short %>%
  mutate(enforcer = ifelse(EF == 1 | EP == 1, 1, 0), 
         deathage = as.numeric(difftime(Death.Date,
                                        Birth.Date,
                                        units = "weeks")/52.25)) %>% 
  group_by(enforcer) %>%
  summarize(`Mean YOB` = mean(DOB.Year), `Mean Age At Death` = mean(deathage))

```




<!-- % latex table generated in R 4.2.2 by xtable 1.8-4 package -->
<!-- % Sep 4  2024 -->
\begin{table}[ht]
\centering
\begin{tabular}{rrrrr}
  \hline
 & $\beta$ & $e^{\beta}$ & s.e. & p-value \\ 
  \hline
  EFTRUE & 0.19994 & 1.22132 & 0.28948 & 0.48977 \\ 
  GP.x & -0.00061 & 0.99939 & 0.00023 & 0.00675 \\ 
  Ht & -0.03414 & 0.96644 & 0.04465 & 0.44455 \\ 
  Wt & 0.02134 & 1.02157 & 0.00658 & 0.00118 \\ 
  DOB.Year & -0.01691 & 0.98323 & 0.00825 & 0.04047 \\ 
  Pos2D & -0.38403 & 0.68111 & 0.17532 & 0.02849 \\ 
  Pos2W & -0.28394 & 0.75281 & 0.15967 & 0.07536 \\ 
   \hline
\end{tabular}
\caption{E-F \label{tab:EF}}
\end{table}




<!-- % latex table generated in R 4.2.2 by xtable 1.8-4 package -->
<!-- % Mon Feb 26 09:04:35 2024 -->
\begin{table}[ht]
\centering
\begin{tabular}{rrrrr}
  \hline
 & $\beta$ & $e^{\beta}$ & s.e. & p-value \\ 
  \hline
EPTRUE & 0.85436 & 2.34988 & 0.26474 & 0.00125 \\ 
  GP.x & -0.00052 & 0.99948 & 0.00022 & 0.01587 \\ 
  Ht & -0.02783 & 0.97255 & 0.04439 & 0.53069 \\ 
  Wt & 0.01859 & 1.01877 & 0.00659 & 0.00480 \\ 
  DOB.Year & -0.01699 & 0.98316 & 0.00831 & 0.04102 \\ 
  $I_D$ & -0.38847 & 0.67810 & 0.17549 & 0.02686 \\ 
  $I_W$ & -0.31332 & 0.73102 & 0.16048 & 0.05089 \\ 
   \hline
   \hline
\end{tabular}
\caption{E-P \label{tab:EP}}
\end{table}



```{r estsurv, echo = FALSE, fig.cap = "Estimated Survival curve for E-P for defenders.  All other variables are fixed at their mean level (GP = 285.8, Ht = 72.7in, Wt = 197.03, and Year of birth 1974.5)"}
coxphmod_EP <- coxph(Surv ~ EP + GP.x + Ht + Wt + DOB.Year + Pos2, data = dat)
# summary(coxphmod_EP)
# library(xtable)
# xtable(summary(coxphmod_EP)$coef[,-4],digits = 5)
# cox.zph(coxphmod_EP)


newdataEP <-
  with(dat, data.frame(EP = c(TRUE, FALSE), 
                       GP.x = rep(mean(GP.x), 2),
                       Ht = rep(mean(Ht), 2),
                       Wt = rep(mean(Wt), 2),
                       DOB.Year = rep(mean(DOB.Year), 2),
                       Pos2 = rep("D", 2))
                       )
#plot(survfit(coxphmod_EP, newdata = newdataEP), conf.int = TRUE, lty = c(1,2))


nnn <- nrow(survfit(coxphmod_EP, newdata = newdataEP)$surv)
ggdat <- data.frame(enforcer = c(rep("Enforcer",nnn),rep("Non-Enforcer",nnn)),
  surv = c(
  survfit(coxphmod_EP, newdata = newdataEP)$surv[, 1],
  survfit(coxphmod_EP, newdata = newdataEP)$surv[, 2]
),
  lower = c(
  survfit(coxphmod_EP, newdata = newdataEP)$lower[, 1],
  survfit(coxphmod_EP, newdata = newdataEP)$lower[, 2]
),
  upper = c(
  survfit(coxphmod_EP, newdata = newdataEP)$upper[, 1],
  survfit(coxphmod_EP, newdata = newdataEP)$upper[, 2]
),
time = rep(survfit(coxphmod_EP, newdata = newdataEP)$time,2)
)
ggplot(aes(x = time,y = surv, color = enforcer), data = ggdat) + geom_path() + geom_path(aes(x = time,y = lower, color = enforcer), lty = 3) + geom_path(aes(x = time,y = upper, color = enforcer), lty = 3) 

#Survival rates are age 50. 
#ggdat %>% filter(time == 50)
#ggdat %>% filter(time > 75 & time < 75.02)
```

<!--Talk about the conditioning on death stuff.  

Age difference statement in Popkin is over stated.  -->

```{r echo = FALSE}
#Enforcer by country
epcountry <- dat %>% mutate(northamerica = ifelse(Ctry %in% c("USA","CAN"),"North America","Other")) %>% group_by(EP, northamerica) %>% summarize(n = n()) %>% pivot_wider(names_from = northamerica, values_from = n) %>% mutate(p = `North America`/(`North America`+ Other))

#prop.test(epcountry$`North America`,epcountry$Other+epcountry$`North America`)


#Enforcer by country
efcountry <- dat %>% mutate(northamerica = ifelse(Ctry %in% c("USA","CAN"),"North America","Other")) %>% group_by(EF, northamerica) %>% summarize(n = n()) %>% pivot_wider(names_from = northamerica, values_from = n)  %>% mutate(p = `North America`/(`North America`+ Other))


#prop.test(efcountry$`North America`,efcountry$Other+efcountry$`North America`)

#How many players are in each group
#table(dat$EP, dat$EF)

```


# Conclusion {#sec:conclusion}
@Popkin2023 presented work looking for differences in mortality rates between NHL enforcers and non-enforcers who played between 1967 and 2022 where they defined enforcers in two ways: one based on the number of career fights and the other based on the average career penalty minutes per game.  They performed a matched-cohort study matching on date of birth, total number of games played, height, weight, and position.  They conclude there there is no statistically significant difference in the mortality rates for either definition of enforcer.  They then go on to perform an additional analysis where they condition on death and show that of players in their matched data set who are deceased, enforcers died an average of about 10 years earlier than their non-enforcer counterparts.  

While we found this work to be of interest, we believe that a more appropriate statistical framework for this analysis is survival analysis.  Therefore, we performed our own extended analysis with additional data using methods from survival analysis to estimate difference survival times between enforcers and non-enforcers.  For enforcers, defined based on number of career fights we find no significant difference in survival times.  Conversely, we do find a significant difference in survival times for enforcers defined based on average penalty minutes per game.  Specifically, we find that enforcers defined in this way have a hazard ratio of 2.34988 (p-value: 0.00125) relative to non-enforcers indicated that there are significant risks associated with the position of enforcer.  
While we find this clear association between enforcers and increased hazard by controlling for the variables that were matched on in @Popkin2023, there are several obvious uncontrolled variables that have substantially different distributions in the enforcer and non-enforcer populations.  One simple example are the differences in average number of goals scores between the two groups significantly different for both definitions of enforcers.  The average number of goals scores for E-F enforcers  vs non-enforcers was `r summ$mngoals[summ$EF]` vs `r summ$mngoals[!summ$EF]` (p-value: `r ifelse(round(t.test(dat$G~dat$EF)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$G~dat$EF)$p.value,2))`).  For E-P enforcers, the average number of goals for enforcers was `r summEP$mngoals[summEP$EP]` vs `r summEP$mngoals[!summEP$EP]` (p-value: `r ifelse(round(t.test(dat$G~dat$EP)$p.value,2) <0.0001,"<0.0001",round(t.test(dat$G~dat$EP)$p.value,2))`).  

Perhaps more interestingly, we find highly significant differences in geographic region of enforcers vs non-enforcers for both definitions.  In the enforcer group `r paste0(100*round(efcountry$p[efcountry$EF],4),"\\%")` and `r paste0(100*round(epcountry$p[epcountry$EP],4),"\\%")` of those groups are from North America (i.e. United States or Canada) for E-F and E-P, respectively.  For non-enforcers, North American players make up only `r paste0(100*round(efcountry$p[!efcountry$EF],4),"\\%")` for E-F and `r paste0(100*round(epcountry$p[!epcountry$EP],4),"\\%")` for E-P.  For both definitions of enforcer, these differences are significant with p-values for both definitions less than 0.0001.  While we do not address this imbalance here, as we focus on closely following the work of @Popkin2023, it is worth noting this imbalance in geographic origin (i.e. North American vs outside of North America) of enforcers versus non-enforcer, and we leave the exploration of this issue for future work.   


 <!-- including date of birth, total number of games played, height, weight, and position played. -->

<!-- Talk about continuous penality minutes stuff? -->







# Acknowledgements {-}

We would like to thank @Popkin2023 for their generosity and willingness to share the data provided for the above analysis.


# Supplementary Material {-}

<!-- All code for reproducing the analyses in this paper is publicly available at https://github.com/gjm112/HockeyEnforcers -->

# References
